<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>みにまるスペリング</title>
 <style>
  /* 確定ボタンのスタイル */
button {
  background-color: #000000; /* 水色 */
  color: white;
  padding: 8px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border: none;
  border-radius: 4px;
}

/* ホバー時のスタイル (任意) */
button:hover {
  background-color: #191970;
}

input[type="text"] {
  width: 200px;
  height: 40px;
  padding: 5px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 18px;
}

select {
  width: 200px;
  height: 40px;
  padding: 5px;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 18px;
}
 </style>
</head>
<body>
 <h1>みにまるスペリング v1.2.4</h1>
 <div id="question-container">
  <p id="question"></p>
  <input type="text" id="answer" placeholder="回答" onkeydown="if (event.key === 'Enter') checkAnswer()">
  <button type="button" onclick="checkAnswer()" style="background-color: #1e90ff;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border: none;
  border-radius: 4px;
}

button:hover {
  background-color: #191970;
}
">確定</button>
  <p id="result"></p>
 </div>

 <h2>結果</h2>
  <p>ミスし単語</p>
  <table id="resultTable">
  <tr>
  </tr>
 </table>
 <script>
   const problems = [
  {
         question: "love at first sight/一目ぼれ",
         answer: "sight",
         },
{
         question: "a taste of lemon/レモンの味",
         answer: "taste",
         },
{
         question: "a wide range of information/広範囲の情報",
         answer: "range",
         },
{
         question: "make an appointment with the doctor/医者に予約する",
         answer: "appointment",
         },
{
         question: "a doctor and a patient/医者と患者",
         answer: "patient",
         },

  ];


  let results = [];
  let currentProblems = [];

  function monsu() {
    const numQuestions = parseInt(document.getElementById("numQuestions").value);
    const isRandom = document.getElementById("order").value === "random";
    currentProblems = isRandom ? problems.slice().sort(() => 0.5 - Math.random()).slice(0, numQuestions) : problems.slice(0, numQuestions);
 if (currentProblems.length === 0) {
        return;
    }


    showNextProblem();
  }

  function checkAnswer() {
   const userAnswer = document.getElementById("answer").value.trim().toLowerCase();
   const currentProblem = currentProblems[0];
   const correctAnswer = currentProblem.answer;
   const resultElement = document.getElementById("result");
   document.getElementById("answer").value = "";
   // 正解の部分を _ で置き換える
   const maskedQuestion = currentProblem.question.replace(new RegExp(`\\b${correctAnswer}\\b`, 'gi'), `${correctAnswer[0]}_____`);
   document.getElementById("question").textContent = maskedQuestion;
   // 結果を配列に保存
   results.push({
    question: currentProblem.question,
    answer: correctAnswer,
    userAnswer: userAnswer,
    isCorrect: userAnswer === correctAnswer
   });
   if (userAnswer === correctAnswer) {
    resultElement.textContent = "正解！次の問題に進んでください。";
    currentProblems.shift();
    if (currentProblems.length > 0) {
     showNextProblem();
    } else {
     resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
     showResults();
    }
   } else {
    // 不正解の場合
    resultElement.textContent = "不正解です。";
    // 正解を表示
    const correctAnswerElement = document.createElement('span');
    correctAnswerElement.textContent = `正解: ${correctAnswer}`;
    correctAnswerElement.style.color = 'red';
    resultElement.appendChild(correctAnswerElement);

    // 2秒後に自動的に次の問題へ進む
    setTimeout(() => {
     currentProblems.shift();
     if (currentProblems.length > 0) {
      showNextProblem();
     } else {
      resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
      showResults();
     }
    }, 2000); // 2秒後に実行
   }
  }

  function showNextProblem() {
   const currentProblem = currentProblems[0];
   const questionElement = document.getElementById("question");
   const maskedQuestion = currentProblem.question.replace(new RegExp(`\\b${currentProblem.answer}\\b`, 'gi'), `${currentProblem.answer[0]}_____`);
   questionElement.textContent = maskedQuestion;

   // 結果表示をクリア
   const resultElement = document.getElementById("result");
   resultElement.textContent = '';
  }

  function showResults() {
   const table = document.getElementById("resultTable");
   table.innerHTML = ''; // 結果テーブルを初期化する
   // 間違えた問題のみを表示
  for (let i = 0; i < results.length; i++) {
        if (!results[i].isCorrect) {
     const tr = document.createElement('tr');
     const tdQuestion = document.createElement('td');
     const tdAnswer = document.createElement('td');
     const tdUserAnswer = document.createElement('td');
     tdQuestion.textContent = results[i].question;
     tdAnswer.textContent = results[i].answer;
     tdUserAnswer.textContent = results[i].userAnswer;
     tr.appendChild(tdQuestion);
     tr.appendChild(tdAnswer);
     tr.appendChild(tdUserAnswer);
     table.appendChild(tr);
    }
   }
   // リセットとリトライボタンを表示
   removeButtons();
   const resetButton = document.createElement('button');
   resetButton.textContent = "リセット";
   resetButton.onclick = resetTest;
   document.body.appendChild(resetButton);

   const retryButton = document.createElement('button');
   retryButton.textContent = "リトライ";
   retryButton.onclick = retryMistakes;
   document.body.appendChild(retryButton);
  }

  function removeButtons() {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
      if (button.textContent === "リセット" || button.textContent === "リトライ") {
        button.remove();
      }
    });
  }

  function resetTest() {
    results = [];
    currentProblems = [];
    document.getElementById("resultTable").innerHTML = '';
    document.getElementById("result").textContent = '';
    monsu();
  }

  function retryMistakes() {
    removeButtons();
    currentProblems = results.filter(result => !result.isCorrect);
    results = [];
    document.getElementById("resultTable").innerHTML = "";
    showNextProblem();
  }

  // テスト開始
  function startTest() {
    const container = document.createElement('div');
    const label = document.createElement('label');
    label.textContent = "問題数:";
    const select = document.createElement('select');
    select.id = "numQuestions";
    for (let i = 1; i <= problems.length; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      select.appendChild(option);
    }
    const orderLabel = document.createElement('label');
    orderLabel.textContent = "出題順:";
    const orderSelect = document.createElement('select');
    orderSelect.id = "order";
    const optionRandom = document.createElement('option');
    optionRandom.value = "random";
    optionRandom.textContent = "ランダム";
    const optionSequential = document.createElement('option');
    optionSequential.value = "sequential";
    optionSequential.textContent = "順番どうり";
    orderSelect.appendChild(optionRandom);
    orderSelect.appendChild(optionSequential);
    const startButton = document.createElement('button');
    startButton.textContent = "スタート";
    startButton.onclick = monsu;
    container.appendChild(label);
    container.appendChild(select);
    container.appendChild(orderLabel);
    container.appendChild(orderSelect);
    container.appendChild(startButton);
    document.body.insertBefore(container, document.getElementById("question-container"));
  }

  startTest();
 </script>
</body>
</html>
