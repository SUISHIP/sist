<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="description" content="英単語のフレーズをテスト形式で定着させよう">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>みにまるスペリング【ReTUNED】</title>
 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KTHSXR8K');</script>
<!-- End Google Tag Manager -->
<style>
  body {
    background-color: white;
    /* サイト背景色 */
  }

  /* 結果セクションのスタイル */
  h2 {
    color: #333;
  }

  #resultTable {
    width: 100%;
    border-collapse: collapse;
  }

  #resultTable,
  #resultTable th,
  #resultTable td {
    border: 1px solid #ddd;
  }

  #resultTable th,
  #resultTable td {
    padding: 8px;
    text-align: left;
  }

  #resultTable tr:nth-child(even) {
    background-color: #f2f2f2;
  }

  #resultTable tr:hover {
    background-color: #ddd;
  }

  #resultTable th {
    background-color: #4CAF50;
    color: white;
  }

  .dark-mode {
    /* DarkMode */
    background-color: #141414 !important;
  }

  .dark-mode h1,
  .dark-mode h2,
  .dark-mode p,
  .dark-mode label,
  .dark-mode input,
  .dark-mode select,
  .dark-mode span {
    color: #C9C9C9;
    background-color: #141414;
  }

  .dark-mode button,
  .dark-mode nav ul a,
  .dark-mode .custom-file-label {
    color: #C9C9C9;
    background-color: #424242;
  }

  .dark-mode #resultTable th,
  .dark-mode #resultTable td {
    color: #C9C9C9;
    background-color: #424242;
  }

  .dark-mode ::selection {
    background-color: #00415B;
    color: #ddd;
  }

  .dark-mode .send_button {
    background_color: #0C1959;
    color: #ddd;
  }

  .dark-mode .correctAnswer {
    color: #923436 !important;
  }

  /* 選択部分の背景色と文字色を変更 */
  ::selection {
    background-color: #FFF499;
    /* 背景色 */
    color: #000;
    /* 文字色 */
  }

  /* 確定ボタンのスタイル */
  button {
    background-color: #000000;
    /* 水色 */
    color: white;
    padding: 8px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
  }

  /* ホバー時のスタイル (任意) */
  button:hover {
    background-color: #191970;
  }

  input[type="text"] {
    width: 200px;
    height: 40px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 18px;
  }

  select {
    width: 110px;
    height: 40px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 18px;
  }

  nav ul {
    list-style-type: none;
    padding: 0;
  }

  nav ul a {
    background-color: #70EFC2;
    color: #1A7593;
    text-decoration: none;
    padding: 5px 10px;
    display: inline-block;
  }

  nav ul a:hover {
    background-color: #ffff8e;
  }

  /* 隠す */
  #fileInput {
    display: none;
  }

  /* カスタムボタンのスタイル */
  .custom-file-label {
    display: inline-block;
    padding: 3px 30px;
    background-color: gray;
    color: white;
    cursor: pointer;
    border-radius: 3px;
  }

  /* カスタムボタンにマウスホバー時の効果 */
  .custom-file-label:hover {
    background-color: black;
  }

  .toggle-button {
    display: none;
    /* 初期状態は非表示 */
  }

  .toggle-text {
    display: none;
    /* 初期状態は非表示 */
  }

  .send_button {
    background-color: #1e90ff;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
  }

  button:hover {
    background-color: #191970;
  }
  
  /* フィードバックリンクの色 */
  .link_color {
    color: #00EAC3;
  }
  .dark-mode .link_color {
    color: red;
  }
  /* グラデーション背景効果 */
    @keyframes gradientBackground {
      0% { background-color: #DDFFBC; }
      20% { background-color: #ADFFFF; }
      50% { background-color: #FFFF6B; }
      100% { background-color: #DDFFBC; }
    }
    #release-link {
      animation: gradientBackground 0.5s 2;
    }
</style>
 <meta name="google-site-verification" content="L7UPbNJ-NeRZkV3O4SyXWtr08Ssi1EZW7HJKD6zgxNw" />
 <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SZM63KK99L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SZM63KK99L');
</script>
</head>
<body>
 <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTHSXR8K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <header>
    <b><nav>
      <ul>
        <a href="make.html">メーカー</a> <a href="https://forms.gle/9QSQrSGTYJXfuzG77">フィードバック</a> <a href="release.html" id="release-link">リリース</a></li>
      </ul>
      </nav></b>
  </header>
  <h1>みにスペ-ReTUNED</h1>
  <label><input type="checkbox" id="dark-toggle">mode</label>
  <label><input type="checkbox" id="toggleCheckbox"> β</label><br>
  <span class="toggle-button"><label for="fileInput" class="custom-file-label">問題をロード</label></span>
<input type="file" id="fileInput" accept=".txt"><br>
 <div id="question-container">
  <p id="question"></p>
  <input type="text" id="answer" placeholder="回答"  autocomplete="off" autofocus>
  <button type="button" onclick="checkAnswer()" class="send_button">確定</button>
  <p id="result"></p>
 </div>
 <h2>結果</h2>
  <p>ミスし単語</p>
  <table id="resultTable">
  <tr>
  </tr>
 </table>
  <span class="toggle-button"><button class="custom-file-label"onclick="download()">ミスし単語.txt</button></span>
 <br>
 <span class="toggle-button">ベータ版の機能です<a href="https://forms.gle/9QSQrSGTYJXfuzG77" class="link_color">フィードバック</a><br>
 <script>
  window.onload = function() {
    populateQuestionDropdowns();
};
const problems = [
  { question: "名所/landmarks", answer: "landmarks" },
  { question: "認知症/dementia", answer: "dementia" },
  { question: "肉/flesh", answer: "flesh" },
  { question: "衝突/collision", answer: "collision" },
  { question: "危険なもの/hazard", answer: "hazard" },
  { question: "墓/tomb", answer: "tomb" },
  { question: "注射/injections", answer: "injections" },
  { question: "飛躍的進歩/breakthrough", answer: "breakthrough" },
  { question: "革/leather", answer: "leather" },
  { question: "宝石/jewelry", answer: "jewelry" },
  { question: "合図/cues", answer: "cues" },
  { question: "救急車/ambulance", answer: "ambulance" },
  { question: "不動産/estate", answer: "estate" },
  { question: "商品/commodity", answer: "commodity" },
  { question: "出発(時刻)/departure", answer: "departure" },
  { question: "段階/phase", answer: "phase" },
  { question: "泥棒/thief", answer: "thief" },
  { question: "聖/Saint", answer: "Saint" },
  { question: "彫刻/sculpture", answer: "sculpture" },
  { question: "悲しみ/grief", answer: "grief" },
  { question: "車線/lane", answer: "lane" },
  { question: "捕食動物/predators", answer: "predators" },
  { question: "流体/fluids", answer: "fluids" },
  { question: "はげみ/incentive", answer: "incentive" },
  { question: "花嫁/bride", answer: "bride" },
  { question: "介入/intervention", answer: "intervention" },
  { question: "(大)差/margin", answer: "margin" },
  { question: "伝記/biography", answer: "biography" },
  { question: "同意/consent", answer: "consent" },
  { question: "火山/volcano", answer: "volcano" },
  { question: "反逆者/rebels", answer: "rebels" },
  { question: "比喩/metaphor", answer: "metaphor" },
  { question: "法律/legislation", answer: "legislation" },
  { question: "雷/lightning", answer: "lightning" },
  { question: "殺虫剤/pesticides", answer: "pesticides" },
  { question: "コラム/column", answer: "column" },
  { question: "うわさ/rumor", answer: "rumor" },
  { question: "ほこり/dust", answer: "dust" },
  { question: "対話/dialogue", answer: "dialogue" },
  { question: "幼稚園/kindergarten", answer: "kindergarten" },
  { question: "糖尿病/diabetes", answer: "diabetes" },
  { question: "肥満/obesity", answer: "obesity" },
  { question: "特許/patent", answer: "patent" },
  { question: "章/chapter", answer: "chapter" },
  { question: "宮殿/Palace", answer: "Palace" },
  { question: "洗濯/laundry", answer: "laundry" },
  { question: "病棟/ward", answer: "ward" },
  { question: "ぼっ発/outbreak", answer: "outbreak" },
  { question: "方程式/equation", answer: "equation" },
  { question: "考古学者/archaeologist", answer: "archaeologist" }
];

  let results = [];
  let currentProblems = [];

   function resetTest() {
    results = [];
    currentProblems = [];
    document.getElementById("resultTable").innerHTML = '';
    document.getElementById("result").textContent = '';
    document.getElementById("answer").disabled = false;
    resetConfirmButton(); // 確定ボタンを有効にする
    monsu();
  }

  function retryMistakes() {
    document.getElementById("answer").disabled = false;
    document.getElementById('answer').value = "";
    document.getElementById('answer').focus();
    removeButtons();
    currentProblems = results.filter(result => !result.isCorrect);
    results = [];
    document.getElementById("resultTable").innerHTML = "";
    if (currentProblems.length > 0) {
        resetConfirmButton(); // 確定ボタンを有効にする
        showNextProblem(); // 最初の問題を表示
    } else {
        document.getElementById("result").textContent = "間違えた問題がありません。";
    }
  }

// 確定ボタンをリセットする関数
function resetConfirmButton() {
    const confirmButton = document.querySelector('button.send_button');
    confirmButton.disabled = false;
}

function checkAnswer() {
    const userAnswer = document.getElementById("answer").value.trim().toLowerCase();
    const currentProblem = currentProblems[0];
    const correctAnswer = currentProblem.answer;
    const resultElement = document.getElementById("result");
    const confirmButton = document.querySelector('button[type="button"]');
    document.getElementById("answer").value = "";

    results.push({
        question: currentProblem.question,
        answer: correctAnswer,
        userAnswer: userAnswer,
        isCorrect: userAnswer === correctAnswer
    });

    if (userAnswer === correctAnswer) {
        resultElement.textContent = "正解！次の問題に進んでください。";
        currentProblems.shift();
        if (currentProblems.length > 0) {
            showNextProblem();
        } else {
            resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
            showResults();
        }
        resetConfirmButton(); // 正解の場合もボタンを有効化
    } else {
        resultElement.textContent = "不正解です。"; // 不正解の場合
        confirmButton.disabled = true;
        resultElement.style.fontSize = '21px';

        const correctAnswerElement = document.createElement('span');
        correctAnswerElement.textContent = ` 正解: ${correctAnswer}`;
        correctAnswerElement.style.color = 'red';//正解の色
        correctAnswerElement.classList.add('correctAnswer');
        correctAnswerElement.style.fontSize = '21px';
        correctAnswerElement.style.cursor = 'pointer';
        resultElement.appendChild(correctAnswerElement);
        
        // 音声読み上げ
        const utterance = new SpeechSynthesisUtterance(correctAnswer);
        utterance.lang = 'en-US'; // 読み上げる言語を指定
        speechSynthesis.speak(utterance);

        countdownTimeout = setTimeout(() => {
            if (!isAnswerClicked) {
                currentProblems.shift();
                if (currentProblems.length > 0) {
                    showNextProblem();
                    resetConfirmButton(); // 次の問題に進む際にボタンを有効化
                    document.getElementById('answer').focus();
                } else {
                    resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
                    showResults();
                }
            }
        }, 2500);

        correctAnswerElement.addEventListener('click', () => {
            if (isAnswerClicked) {
                currentProblems.shift();
                if (currentProblems.length > 0) {
                    showNextProblem();
                    document.getElementById('answer').focus();//forcus
                    resetConfirmButton(); // クリック後にボタンを有効化
                } else {
                    resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
                    showResults();
                }
            } else {
                clearTimeout(countdownTimeout);
                isAnswerClicked = true;
            }
        });
    }
}
   
   function populateQuestionDropdowns() {
    problems.forEach((problem, index) => {
      const option = document.createElement("option");
      option.value = index;
      option.textContent = index + 1;
    });
  }
   // Fisher-Yatesアルゴリズムを使ってシャッフルする関数
function fisherYatesShuffle(array) {
    document.getElementById("answer").disabled = false;
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); // 0 から i までのランダムなインデックスを取得
        [array[i], array[j]] = [array[j], array[i]]; // 要素を入れ替える
    }
    return array;
}
   
   
   function monsu() {
  document.getElementById("answer").disabled = false
  document.getElementById("answer").value = "";
  document.getElementById('answer').focus();
  const numQuestions = parseInt(document.getElementById("numQuestions").value);
  const isRandom = document.getElementById("order").value === "random";
  currentProblems = problems.slice(startIndex, endIndex + 1);
  if (isRandom) {
    currentProblems = fisherYatesShuffle(currentProblems); // Fisher-Yatesでシャッフル
  }
  currentProblems = currentProblems.slice(0, numQuestions);
  showNextProblem();
  resetConfirmButton();
}

 document.getElementById("answer").addEventListener("keydown", function(event) {
    const confirmButton = document.querySelector('button[type="button"]'); // 「確定」ボタンの取得
    if (event.key === 'Enter' && !confirmButton.disabled) {
        checkAnswer(); // 「確定」ボタンが有効な場合のみ実行
    }
});

let countdownTimeout; // カウントダウンを管理するタイマー変数
let isAnswerClicked = false; // 赤文字がクリックされたかどうかを管理するフラグ



  function showNextProblem() {
   isAnswerClicked = false;
   const currentProblem = currentProblems[0];
   const questionElement = document.getElementById("question");
   const maskedQuestion = currentProblem.question.replace(new RegExp(`\\b${currentProblem.answer}\\b`, 'gi'), `${currentProblem.answer[0]}_____`);
   questionElement.textContent = maskedQuestion;

   // 結果表示をクリア
   const resultElement = document.getElementById("result");
   resultElement.textContent = '';
  }

  function showResults() {
  const table = document.getElementById("resultTable");
  table.innerHTML = ''; // 結果テーブルを初期化する

  let correctAnswers = 0; // 正解数をカウント
  let totalQuestions = results.length; // 全体の問題数

  // 間違えた問題のみを表示
  for (let i = 0; i < results.length; i++) {
    if (!results[i].isCorrect) { // 不正解の問題のみを表示
      const tr = document.createElement('tr');
      const tdQuestion = document.createElement('td');
      const tdAnswer = document.createElement('td');
      const tdUserAnswer = document.createElement('td');
      tdQuestion.textContent = results[i].question;
      tdAnswer.textContent = results[i].answer;
      tdUserAnswer.textContent = results[i].userAnswer;
      tr.appendChild(tdQuestion);
      tr.appendChild(tdAnswer);
      tr.appendChild(tdUserAnswer);
      table.appendChild(tr);
    } else {
      correctAnswers++; // 正解の場合、正解数カウントを増やす
    }
  }

  // 正答率の計算 (パーセンテージ)
  const accuracy = (correctAnswers / totalQuestions) * 100;

  // 正答率の表示
  const resultContainer = document.getElementById("result");
  const accuracyElement = document.createElement('p');
  accuracyElement.textContent = `正答率: ${accuracy.toFixed(2)}%`;
  resultContainer.appendChild(accuracyElement);  // 正答率を表示

  // リセットとリトライボタンを表示
  removeButtons();
  const resetButton = document.createElement('button');
  resetButton.textContent = "リセット";
  resetButton.onclick = resetTest;
  document.body.appendChild(resetButton);

  const retryButton = document.createElement('button');
  retryButton.textContent = "リトライ";
  retryButton.onclick = retryMistakes;
  document.body.appendChild(retryButton);
}

  function removeButtons() {
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
      if (button.textContent === "リセット" || button.textContent === "リトライ") {
        button.remove();
      }
    });
  }




 // テスト開始
function startTest() {
    document.getElementById("answer").disabled = false;
    const container = document.createElement('div');
    const select = document.createElement('select');
    select.id = "numQuestions";
    
    // 最初に固定のオプションを追加
  const fixedOptions = [
  { value: 1, text: "1問" },
  { value: 3, text: "3問"},
  { value: 10, text: "10問"},
  { value: 25, text: "25問",selected: true},
  { value: problems.length, text: "ALL"}
];

    
  fixedOptions.forEach(optionData => {
  const option = document.createElement('option');
  option.value = optionData.value;
  option.textContent = optionData.text;
  
  // デフォルトでselectedを選択状態にする
  if (optionData.selected) {
    option.selected = true;
  }
  
  select.appendChild(option);
});

    // 残りのオプションを1から全ての問題数まで順番に追加
    for (let i = 1; i <= problems.length; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      select.appendChild(option);
    }
    
    const orderSelect = document.createElement('select');
    orderSelect.id = "order";
    
    const optionRandom = document.createElement('option');
    optionRandom.value = "random";
    optionRandom.textContent = "ランダム";
    
    const optionSequential = document.createElement('option');
    optionSequential.value = "sequential";
    optionSequential.textContent = "順番どうり";
    
    orderSelect.appendChild(optionRandom);
    orderSelect.appendChild(optionSequential);
    
    const startButton = document.createElement('button');
    startButton.textContent = "スタート";
    startButton.onclick = monsu;
    
    container.appendChild(label);
    container.appendChild(select);
    container.appendChild(orderLabel);
    container.appendChild(orderSelect);
    container.appendChild(startButton);
    
    document.body.insertBefore(container, document.getElementById("question-container"));
}

startTest();

   function download() {
  let table = document.getElementById("resultTable");
  let rows = table.getElementsByTagName("tr");
  if (rows.length === 0 || (rows.length === 1 && rows[0].cells.length === 0)) {
  alert("ダウンロードするミスし単語がありません。");
  return;
}

  let textData = "";

  for (let i = 0; i < rows.length; i++) {
    let cells = rows[i].getElementsByTagName("td");
    for (let j = 0; j < cells.length; j++) {
      textData += cells[j].innerText + "\t"; // タブ区切りでデータを追加
    }
    textData += "\n"; // 各行の終わりに改行を追加
  }

  let blob = new Blob([textData], { type: "text/plain" });
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "ミスし単語.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
document.getElementById('fileInput').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const content = e.target.result;
      setProblemsFromFile(content);
    };
    reader.readAsText(file);
  }
});

function setProblemsFromFile(content) {
  const lines = content.split('\n');
  problems.length = 0; // 既存の問題をクリア
  lines.forEach(line => {
    const [question, answer] = line.split('\t');
    if (question && answer) {
      problems.push({ question: question.trim(), answer: answer.trim() });
    }
  });
  populateQuestionDropdowns();
  resetTest();
}
 // ファイルが選択されたら、そのファイル名をラベルに表示
        const fileInput = document.getElementById('fileInput');
        const label = document.querySelector('.custom-file-label');

        fileInput.addEventListener('change', function() {
            const fileName = fileInput.files.length > 0 ? fileInput.files[0].name : 'ファイルをアップロード';
            label.textContent = fileName;
        });
   
   const checkbox = document.getElementById('toggleCheckbox');
        const toggleButtons = document.querySelectorAll('.toggle-button'); // すべてのボタンを取得

        checkbox.addEventListener('change', function() {
            toggleButtons.forEach(function(button) {
                if (checkbox.checked) {
                    button.style.display = 'inline'; // チェックされている場合は表示
                } else {
                    button.style.display = 'none'; // チェックされていない場合は非表示
                }
            });
        });
   const darkToggle = document.getElementById('dark-toggle');//ダークモード
    darkToggle.addEventListener('change', function() {
      if (darkToggle.checked) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    });
  
   document.addEventListener('DOMContentLoaded', function() { //matchMedia API
    const darkModeCheckbox = document.getElementById('dark-toggle');
    
    // ユーザーのダークモード設定を確認
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    
    if (prefersDarkScheme.matches) {
        // ダークモードが有効な場合、チェックボックスをチェック状態にする
        darkModeCheckbox.checked = true;
        document.body.classList.add('dark-mode');
    } else {
        // ライトモードの場合はチェックを外す
        darkModeCheckbox.checked = false;
        document.body.classList.remove('dark-mode');
    }

    // OSのテーマが変更されたときに対応する
    prefersDarkScheme.addEventListener('change', (e) => {
        if (e.matches) {
            darkModeCheckbox.checked = true;
        } else {
            darkModeCheckbox.checked = false;
        }
    });
});
</script>
</body>
</html>
