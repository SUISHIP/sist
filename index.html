<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="英単語のフレーズをテスト形式で定着させよう">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みにまるスペリング【ReTUNED】</title>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTHSXR8K');</script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Murecho:wght@400;700&display=swap');
     body {
            font-family: 'Murecho', sans-serif;
    }

    h2 {
        color: #333;
    }

    #resultTable {
        width: 100%;
        border-collapse: collapse;
    }

    #resultTable,
    #resultTable th,
    #resultTable td {
        border: 1px solid #ddd;
    }

    #resultTable th,
    #resultTable td {
        padding: 8px;
        text-align: left;
    }

    #resultTable tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    #resultTable tr:hover {
        background-color: #ddd;
    }

    #resultTable th {
        background-color: #4CAF50;
        color: white;
    }

    .dark-mode {
        background-color: #141414 !important;
    }

    .dark-mode h1,
    .dark-mode h2,
    .dark-mode p,
    .dark-mode label,
    .dark-mode input,
    .dark-mode select,
    .dark-mode span {
        color: #C9C9C9;
        background-color: #141414;
    }

    .dark-mode button,
    .dark-mode nav ul a,
    .dark-mode .custom-file-label {
        color: #C9C9C9;
        background-color: #424242;
    }

    .dark-mode #resultTable th,
    .dark-mode #resultTable td {
        color: #C9C9C9;
        background-color: #424242;
    }

    .dark-mode ::selection {
        background-color: #00415B;
        color: #ddd;
    }

    .dark-mode .send_button {
        background-color: #0C1959;
        color: #ddd;
    }

    .dark-mode .correctAnswer {
        color: #923436 !important;
    }

    ::selection {
        background-color: #FFF499;
        color: #000;
    }

    button {
        background-color: #000000;
        color: white;
        padding: 8px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
    }

    button:hover {
        background-color: #191970;
    }

    input[type="text"] {
        width: 200px;
        height: 40px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 18px;
    }

    select {
        width: 110px;
        height: 40px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 18px;
    }

    nav ul {
        list-style-type: none;
        padding: 0;
    }

    nav ul a {
        background-color: #70EFC2;
        color: #1A7593;
        text-decoration: none;
        padding: 5px 10px;
        display: inline-block;
    }

    nav ul a:hover {
        background-color: #ffff8e;
    }

    #fileInput {
        display: none;
    }

    .custom-file-label {
        display: inline-block;
        padding: 3px 30px;
        background-color: gray;
        color: white;
        cursor: pointer;
        border-radius: 3px;
    }

    .custom-file-label:hover {
        background-color: black;
    }

    .toggle-button {
        display: inline;
    }

    .toggle-text {
        display: none;
    }

    .send_button {
        background-color: #1e90ff;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border: none;
        border-radius: 4px;
    }

    .link_color {
        color: #00EAC3;
    }
    .dark-mode .link_color {
        color: red;
    }
    @keyframes gradientBackground {
        0% { background-color: #DDFFBC; }
        20% { background-color: #ADFFFF; }
        50% { background-color: #FFFF6B; }
        100% { background-color: #DDFFBC; }
    }
    #release-link {
        animation: gradientBackground 0.5s 2;
    }
    #question-container {
        display: none;
    }
    #result {
        display: none;
    }
    #mistakes-title {
        display: none;
    }
</style>
    <meta name="google-site-verification" content="L7UPbNJ-NeRZkV3O4SyXWtr08Ssi1EZW7HJKD6zgxNw" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZM63KK99L"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SZM63KK99L');
    </script>
</head>
<body class="dark-mode">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTHSXR8K"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <header>
        <b><nav>
            <ul>
                <a href="make.html">メーカー</a> <a href="https://forms.gle/9QSQrSGTYJXfuzG77">フィードバック</a> <a href="release.html" id="release-link">リリース</a>
            </ul>
        </nav></b>
    </header>
    <h1>みにスペ-ReTUNED</h1>
    <div id="question-container">
        <p id="question"></p>
        <input type="text" id="answer" placeholder="回答" autocomplete="off" autofocus>
        <button type="button" onclick="checkAnswer()" class="send_button">確定</button>
        <p id="result"></p>
    </div>
    <h2 id="mistakes-title">ミスし単語</h2>
    <table id="resultTable">
        <thead>
            <tr></tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <audio id="correctSound" src="https://suiship.github.io/sist/correct.mp3" preload="auto"></audio>
<script>
    window.onload = function() {
        startTest();
    };
    const problems = [
        { question: "名所/landmarks", answer: "landmarks" },
        { question: "認知症/dementia", answer: "dementia" },
        { question: "肉/flesh", answer: "flesh" },
        { question: "衝突/collision", answer: "collision" },
        { question: "危険なもの/hazard", answer: "hazard" },
        { question: "墓/tomb", answer: "tomb" },
        { question: "注射/injections", answer: "injections" },
        { question: "飛躍的進歩/breakthrough", answer: "breakthrough" },
        { question: "革/leather", answer: "leather" },
        { question: "宝石/jewelry", answer: "jewelry" },
        { question: "合図/cues", answer: "cues" },
        { question: "救急車/ambulance", answer: "ambulance" },
        { question: "不動産/estate", answer: "estate" },
        { question: "商品/commodity", answer: "commodity" },
        { question: "出発(時刻)/departure", answer: "departure" },
        { question: "段階/phase", answer: "phase" },
        { question: "泥棒/thief", answer: "thief" },
        { question: "聖/Saint", answer: "Saint" },
        { question: "彫刻/sculpture", answer: "sculpture" },
        { question: "悲しみ/grief", answer: "grief" },
        { question: "車線/lane", answer: "lane" },
        { question: "捕食動物/predators", answer: "predators" },
        { question: "流体/fluids", answer: "fluids" },
        { question: "はげみ/incentive", answer: "incentive" },
        { question: "花嫁/bride", answer: "bride" },
        { question: "介入/intervention", answer: "intervention" },
        { question: "(大)差/margin", answer: "margin" },
        { question: "伝記/biography", answer: "biography" },
        { question: "同意/consent", answer: "consent" },
        { question: "火山/volcano", answer: "volcano" },
        { question: "反逆者/rebels", answer: "rebels" },
        { question: "比喩/metaphor", answer: "metaphor" },
        { question: "法律/legislation", answer: "legislation" },
        { question: "雷/lightning", answer: "lightning" },
        { question: "殺虫剤/pesticides", answer: "pesticides" },
        { question: "コラム/column", answer: "column" },
        { question: "うわさ/rumor", answer: "rumor" },
        { question: "ほこり/dust", answer: "dust" },
        { question: "対話/dialogue", answer: "dialogue" },
        { question: "幼稚園/kindergarten", answer: "kindergarten" },
        { question: "糖尿病/diabetes", answer: "diabetes" },
        { question: "肥満/obesity", answer: "obesity" },
        { question: "特許/patent", answer: "patent" },
        { question: "章/chapter", answer: "chapter" },
        { question: "宮殿/Palace", answer: "Palace" },
        { question: "洗濯/laundry", answer: "laundry" },
        { question: "病棟/ward", answer: "ward" },
        { question: "ぼっ発/outbreak", answer: "outbreak" },
        { question: "方程式/equation", answer: "equation" },
        { question: "考古学者/archaeologist", answer: "archaeologist" }
    ];

    let results = [];
    let currentProblems = [];

    function resetTest() {
        results = [];
        currentProblems = [];
        document.getElementById("resultTable").querySelector('tbody').innerHTML = '';
        document.getElementById("result").textContent = '';
        document.getElementById("question-container").style.display = 'block';
        document.getElementById("result").style.display = 'none';
        document.getElementById("mistakes-title").style.display = 'none';
        document.getElementById("answer").disabled = false;
        removeButtons();
        monsu();
    }

    function retryMistakes() {
        document.getElementById("answer").disabled = false;
        document.getElementById('answer').value = "";
        document.getElementById('answer').focus();
        removeButtons();
        currentProblems = results.filter(result => !result.isCorrect);
        results = [];
        document.getElementById("resultTable").querySelector('tbody').innerHTML = "";
        document.getElementById("question-container").style.display = 'block';
        document.getElementById("result").style.display = 'none';
        document.getElementById("mistakes-title").style.display = 'none';
        if (currentProblems.length > 0) {
            resetConfirmButton();
            showNextProblem();
        } else {
            document.getElementById("result").textContent = "間違えた問題がありません。";
            document.getElementById("result").style.display = 'block';
        }
    }

    function resetConfirmButton() {
        const confirmButton = document.querySelector('button.send_button');
        confirmButton.disabled = false;
    }

    function checkAnswer() {
        const userAnswer = document.getElementById("answer").value.trim().toLowerCase();
        const currentProblem = currentProblems[0];
        const correctAnswer = currentProblem.answer.toLowerCase();
        const resultElement = document.getElementById("result");
        const confirmButton = document.querySelector('button.send_button');
        document.getElementById("answer").value = "";
        sound();
        results.push({
            question: currentProblem.question,
            answer: currentProblem.answer,
            userAnswer: userAnswer,
            isCorrect: userAnswer === correctAnswer
        });

        if (userAnswer === correctAnswer) {
            resultElement.textContent = "正解！";
            resultElement.style.display = 'block';
            currentProblems.shift();
            if (currentProblems.length > 0) {
                setTimeout(showNextProblem, 150);
            } else {
                resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
                showResults();
            }
            resetConfirmButton();
        } else {
            resultElement.textContent = "不正解です。";
            confirmButton.disabled = true;
            resultElement.style.fontSize = '21px';
            resultElement.style.display = 'block';

            const correctAnswerElement = document.createElement('span');
            correctAnswerElement.textContent = ` 正解: ${currentProblem.answer}`;
            correctAnswerElement.style.color = 'red';
            correctAnswerElement.classList.add('correctAnswer');
            correctAnswerElement.style.fontSize = '21px';
            resultElement.appendChild(correctAnswerElement);
            
            const utterance = new SpeechSynthesisUtterance(currentProblem.answer);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);

            setTimeout(() => {
                currentProblems.shift();
                if (currentProblems.length > 0) {
                    showNextProblem();
                    resetConfirmButton();
                    document.getElementById('answer').focus();
                } else {
                    resultElement.textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
                    showResults();
                }
            }, 1500);
        }
    }
    
    function fisherYatesShuffle(array) {
        document.getElementById("answer").disabled = false;
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    
    function monsu() {
        document.getElementById("answer").disabled = false;
        document.getElementById("answer").value = "";
        document.getElementById('answer').focus();
        const numQuestions = parseInt(document.getElementById("numQuestions").value);
        const isRandom = document.getElementById("order").value === "random";
        currentProblems = problems.slice();
        if (isRandom) {
            currentProblems = fisherYatesShuffle(currentProblems);
        }
        currentProblems = currentProblems.slice(0, numQuestions);
        document.getElementById("question-container").style.display = 'block';
        showNextProblem();
        resetConfirmButton();
    }

    document.getElementById("answer").addEventListener("keydown", function(event) {
        const confirmButton = document.querySelector('button.send_button');
        if (event.key === 'Enter' && !confirmButton.disabled) {
            checkAnswer();
        }
    });

    function showNextProblem() {
        const currentProblem = currentProblems[0];
        const questionElement = document.getElementById("question");
        const maskedQuestion = currentProblem.question.replace(new RegExp(currentProblem.answer, 'gi'), `${currentProblem.answer[0]}_____`);
        questionElement.textContent = maskedQuestion;

        const resultElement = document.getElementById("result");
        resultElement.textContent = '';
        resultElement.style.display = 'none';
        document.getElementById('answer').focus();
    }

function showResults() {
    const tableBody = document.getElementById("resultTable").querySelector('tbody');
    tableBody.innerHTML = '';

    let correctAnswers = 0;
    let totalQuestions = results.length;
    let hasMistakes = false;

    for (let i = 0; i < results.length; i++) {
        if (!results[i].isCorrect) {
            hasMistakes = true;
            const tr = document.createElement('tr');
            const tdQuestion = document.createElement('td');
            const tdAnswer = document.createElement('td');
            const tdUserAnswer = document.createElement('td');
            tdQuestion.textContent = results[i].question;
            tdAnswer.textContent = results[i].answer;
            tdUserAnswer.textContent = results[i].userAnswer || '(未回答)';
            tr.appendChild(tdQuestion);
            tr.appendChild(tdAnswer);
            tr.appendChild(tdUserAnswer);
            tableBody.appendChild(tr);
        } else {
            correctAnswers++;
        }
    }

    if (hasMistakes) {
        document.getElementById('mistakes-title').style.display = 'block';
    } else {
        document.getElementById('mistakes-title').style.display = 'none';
    }

    const accuracy = totalQuestions > 0 ? (correctAnswers / totalQuestions) * 100 : 0;

    const resultContainer = document.getElementById("result");
    resultContainer.innerHTML = '';

    const accuracyElement = document.createElement('p');
    accuracyElement.textContent = `正答率: ${accuracy.toFixed(1)}% (${correctAnswers}/${totalQuestions})`;
    resultContainer.appendChild(accuracyElement);
    resultContainer.style.display = 'block';

    document.getElementById("question-container").style.display = 'none';

    removeButtons();

    const buttonContainer = document.createElement('div');
    buttonContainer.id = 'result-buttons';

    const resetButton = document.createElement('button');
    resetButton.textContent = "リセット";
    resetButton.onclick = resetTest;
    buttonContainer.appendChild(resetButton);

    if (hasMistakes) {
        const retryButton = document.createElement('button');
        retryButton.textContent = "リトライ";
        retryButton.onclick = retryMistakes;
        buttonContainer.appendChild(retryButton);
    }

    // 表の下にボタンを追加
    document.getElementById("resultTable").after(buttonContainer);
}

function removeButtons() {
    const oldContainer = document.getElementById('result-buttons');
    if (oldContainer) {
        oldContainer.remove();
    }
}

    function startTest() {
        document.getElementById("answer").disabled = false;
        const container = document.createElement('div');
        const select = document.createElement('select');
        select.id = "numQuestions";
        
        const fixedOptions = [
            { value: 1, text: "1問" },
            { value: 3, text: "3問"},
            { value: 10, text: "10問"},
            { value: 25, text: "25問", selected: true},
            { value: problems.length, text: "ALL"}
        ];

        fixedOptions.forEach(optionData => {
            const option = document.createElement('option');
            option.value = optionData.value;
            option.textContent = optionData.text;
            if (optionData.selected) {
                option.selected = true;
            }
            select.appendChild(option);
        });
        
        const orderSelect = document.createElement('select');
        orderSelect.id = "order";
        
        const optionRandom = document.createElement('option');
        optionRandom.value = "random";
        optionRandom.textContent = "ランダム";
        
        const optionSequential = document.createElement('option');
        optionSequential.value = "sequential";
        optionSequential.textContent = "順番どうり";
        
        orderSelect.appendChild(optionRandom);
        orderSelect.appendChild(optionSequential);
        
        const startButton = document.createElement('button');
        startButton.textContent = "スタート";
        startButton.onclick = () => {
            monsu();
        };
        
        container.appendChild(select);
        container.appendChild(orderSelect);
        container.appendChild(startButton);
        
        document.body.insertBefore(container, document.getElementById("question-container"));
    }
  
function sound() {
  const audio = document.getElementById('correctSound');
  if (audio) {
    audio.currentTime = 0;
    audio.play().catch(e => {
      console.warn('音声の再生に失敗:', e);
    });
  }
}
</script>
</body>
</html>
