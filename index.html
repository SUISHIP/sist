<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="英単語のフレーズをテスト形式で定着させよう">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>みにまるスペリング【ReTUNED】</title>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTHSXR8K');</script>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Murecho:wght@400;700&display=swap');

/* 基本設定 */
body {
    font-family: 'Murecho', sans-serif;
    margin: 1em;
    color: #C9C9C9;
    background-color: #141414;
}

::selection {
    background-color: #00415B;
    color: #ddd;
}

/* テーブルスタイル */
#resultTable {
    width: 95%;
    border-collapse: collapse;
    margin-top: 1em;
    border: 1px solid #ddd;
}

#resultTable th,
#resultTable td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

#resultTable th {
    background-color: #3a3a3a;
    color: white;
}

#resultTable td {
    background-color: #2a2a2a;
    color: #C9C9C9;
}

#resultTable tr:nth-child(even) {
    background-color: #222;
}

#resultTable tr:hover {
    background-color: #ddd;
}

/* フォーム要素 */
input[type="text"],
select {
    color: #C9C9C9;
    background-color: #424242;
    height: 40px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 18px;
}

input[type="text"] {
    width: 200px;
}

/* ボタン */
button,
nav ul a {
    color: #C9C9C9;
    background-color: #424242;
    padding: 8px 10px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
}

button:hover,
nav ul a:hover {
    opacity: 0.8;
    background-color: #ffff8e;
}

.send_button {
    background-color: #0C1959;
    padding: 15px 32px;
}

/* ナビゲーション */
nav ul {
    list-style-type: none;
    padding: 0;
}

nav ul a {
    background-color: #70EFC2;
    color: #1A7593;
}

/* アニメーション */
@keyframes gradientBackground {
    0% { background-color: #DDFFBC; }
    20% { background-color: #ADFFFF; }
    50% { background-color: #FFFF6B; }
    100% { background-color: #DDFFBC; }
}

#release-link {
    animation: gradientBackground 0.5s 2;
}

/* その他 */
.correctAnswer {
    color: red !important;
}
#result, #question {
    font-size: 24px;
}
/* 初期非表示 */
#question-container,
#result,
#mistakes-title,
#result-buttons,
#resultTable thead {
    display: none;
}

    </style>
    <meta name="google-site-verification" content="L7UPbNJ-NeRZkV3O4SyXWtr08Ssi1EZW7HJKD6zgxNw" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZM63KK99L"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-SZM63KK99L');
    </script>
</head>

<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTHSXR8K"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <header>
        <nav>
            <ul>
                <a href="make.html">メーカー</a> <a href="https://forms.gle/9QSQrSGTYJXfuzG77">フィードバック</a> <a href="release.html" id="release-link">リリース</a>
            </ul>
        </nav>
    </header>

    <h1>みにスペ-ReTUNED</h1>

    <!-- セット -->
    <div id="start-controls">
        <select id="numQuestions">
            <option value="1">1問</option>
            <option value="3">3問</option>
            <option value="10">10問</option>
            <option value="25" selected>25問</option>
            <option value="50">ALL</option>
        </select>
        <select id="order">
            <option value="random">ランダム</option>
            <option value="sequential">順番どうり</option>
        </select>
        <button onclick="startTest()">スタート</button>
    </div>

    <!-- テスト -->
    <div id="question-container">
        <p id="question"></p>
        <input type="text" id="answer" placeholder="回答" autocomplete="off" autofocus>
        <button type="button" onclick="checkAnswer()" class="send_button">確定</button>
        <p id="result"></p>
    </div>

    <!-- リザルト -->
    <h2 id="mistakes-title">ミスした単語</h2>
    <table id="resultTable">
        <thead>
            <tr>
                <th>問題</th>
                <th>正解</th>
                <th>あなたの回答</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <div id="result-buttons">
        <button onclick="startTest()">リセット</button>
        <button id="retry-button" onclick="retryMistakes()">リトライ</button>
    </div>

    <audio id="correctSound" src="https://suiship.github.io/sist/correct.mp3" preload="auto"></audio>

<script>
    const problems = [
        { question: "名所/landmarks", answer: "landmarks" },
        { question: "認知症/dementia", answer: "dementia" },
        { question: "肉/flesh", answer: "flesh" },
        { question: "衝突/collision", answer: "collision" },
        { question: "危険なもの/hazard", answer: "hazard" },
        { question: "墓/tomb", answer: "tomb" },
        { question: "注射/injections", answer: "injections" },
        { question: "飛躍的進歩/breakthrough", answer: "breakthrough" },
        { question: "革/leather", answer: "leather" },
        { question: "宝石/jewelry", answer: "jewelry" },
        { question: "合図/cues", answer: "cues" },
        { question: "救急車/ambulance", answer: "ambulance" },
        { question: "不動産/estate", answer: "estate" },
        { question: "商品/commodity", answer: "commodity" },
        { question: "出発(時刻)/departure", answer: "departure" },
        { question: "段階/phase", answer: "phase" },
        { question: "泥棒/thief", answer: "thief" },
        { question: "聖/Saint", answer: "Saint" },
        { question: "彫刻/sculpture", answer: "sculpture" },
        { question: "悲しみ/grief", answer: "grief" },
        { question: "車線/lane", answer: "lane" },
        { question: "捕食動物/predators", answer: "predators" },
        { question: "流体/fluids", answer: "fluids" },
        { question: "はげみ/incentive", answer: "incentive" },
        { question: "花嫁/bride", answer: "bride" },
        { question: "介入/intervention", answer: "intervention" },
        { question: "(大)差/margin", answer: "margin" },
        { question: "伝記/biography", answer: "biography" },
        { question: "同意/consent", answer: "consent" },
        { question: "火山/volcano", answer: "volcano" },
        { question: "反逆者/rebels", answer: "rebels" },
        { question: "比喩/metaphor", answer: "metaphor" },
        { question: "法律/legislation", answer: "legislation" },
        { question: "雷/lightning", answer: "lightning" },
        { question: "殺虫剤/pesticides", answer: "pesticides" },
        { question: "コラム/column", answer: "column" },
        { question: "うわさ/rumor", answer: "rumor" },
        { question: "ほこり/dust", answer: "dust" },
        { question: "対話/dialogue", answer: "dialogue" },
        { question: "幼稚園/kindergarten", answer: "kindergarten" },
        { question: "糖尿病/diabetes", answer: "diabetes" },
        { question: "肥満/obesity", answer: "obesity" },
        { question: "特許/patent", answer: "patent" },
        { question: "章/chapter", answer: "chapter" },
        { question: "宮殿/Palace", answer: "Palace" },
        { question: "洗濯/laundry", answer: "laundry" },
        { question: "病棟/ward", answer: "ward" },
        { question: "ぼっ発/outbreak", answer: "outbreak" },
        { question: "方程式/equation", answer: "equation" },
        { question: "考古学者/archaeologist", answer: "archaeologist" }
    ];

    // ALLオプションのvalueを問題数に設定
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('#numQuestions option[value="50"]').value = problems.length;
    });

    let results = [];
    let currentProblems = [];

    // Fisher-Yates shuffle ってやつ
    function fisherYatesShuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startTest() {
        resetUI();

        const numQuestions = parseInt(document.getElementById("numQuestions").value);
        const isRandom = document.getElementById("order").value === "random";
        
        currentProblems = problems.slice();
        if (isRandom) {
            currentProblems = fisherYatesShuffle(currentProblems);
        }
        currentProblems = currentProblems.slice(0, numQuestions);
        
        if (currentProblems.length > 0) {
            // UIを切り替え
            document.getElementById("question-container").style.display = 'block';
            document.getElementById("answer").disabled = false;
            document.getElementById("answer").value = "";
            document.getElementById('answer').focus();
            showNextProblem();
        }
    }

    function showNextProblem() {
        if (currentProblems.length === 0) {
            document.getElementById("result").textContent = "回答が完了しました。結果を確認しましょう↓ ↓ ↓";
            showResults();
            return;
        }

        const currentProblem = currentProblems[0];
        const questionElement = document.getElementById("question");
        const maskedQuestion = currentProblem.question.replace(new RegExp(currentProblem.answer, 'gi'), `${currentProblem.answer[0]}_____`);
        questionElement.textContent = maskedQuestion;

        const resultElement = document.getElementById("result");
        resultElement.textContent = '';
        resultElement.style.display = 'none';
        document.getElementById('answer').focus();
    }

    function checkAnswer() {
        const userAnswer = document.getElementById("answer").value.trim().toLowerCase();

        const currentProblem = currentProblems[0];
        const correctAnswer = currentProblem.answer.toLowerCase();
        const resultElement = document.getElementById("result");
        const confirmButton = document.querySelector('button.send_button');
        
        document.getElementById("answer").value = "";

        const isCorrect = userAnswer === correctAnswer;
        results.push({
            question: currentProblem.question,
            answer: currentProblem.answer,
            userAnswer: userAnswer,
            isCorrect: isCorrect
        });

        if (isCorrect) {
            resultElement.textContent = "正解！";
            resultElement.style.color = '#4CAF50';
            document.getElementById('correctSound').play().catch(e => console.warn('音声の再生に失敗:', e));
            currentProblems.shift();
            setTimeout(showNextProblem, 50);
        } else {
            confirmButton.disabled = true;
            resultElement.innerHTML = `不正解: <span class="correctAnswer">${currentProblem.answer}</span>`;
            
            const utterance = new SpeechSynthesisUtterance(currentProblem.answer);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);

            setTimeout(() => {
                currentProblems.shift();
                confirmButton.disabled = false;
                showNextProblem();
            }, 1500);
        }
        resultElement.style.display = 'block';
    }

    // Enterキー
    document.getElementById("answer").addEventListener("keydown", function(event) {
        if (event.key === 'Enter' && !document.querySelector('button.send_button').disabled) {
            checkAnswer();
        }
    });

    function showResults() {
        const tableBody = document.getElementById("resultTable").querySelector('tbody');
        tableBody.innerHTML = '';
        
        let correctAnswers = 0;
        let hasMistakes = false;

        results.forEach(result => {
            if (result.isCorrect) {
                correctAnswers++;
            } else {
                hasMistakes = true;
                const tr = tableBody.insertRow();
                tr.insertCell().textContent = result.question;
                tr.insertCell().textContent = result.answer;
                tr.insertCell().textContent = result.userAnswer || '(未回答)';
            }
        });
        
        const accuracy = results.length > 0 ? (correctAnswers / results.length) * 100 : 0;
        const resultContainer = document.getElementById("result");
        resultContainer.innerHTML = `正答率: ${accuracy.toFixed(1)}% (${correctAnswers}/${results.length})`;
        resultContainer.style.display = 'block';

        document.getElementById("question-container").style.display = 'none';
        document.getElementById("result-buttons").style.display = 'block';
        
        if (hasMistakes) {
            document.getElementById('mistakes-title').style.display = 'block';
            document.getElementById("resultTable").querySelector('thead').style.display = 'table-header-group';
        } else {
            document.getElementById('mistakes-title').style.display = 'none';
            document.getElementById("resultTable").querySelector('thead').style.display = 'none';
        }
        document.getElementById('retry-button').style.display = hasMistakes ? 'inline-block' : 'none';
    }

    function resetUI() {
        results = [];
        currentProblems = [];
        
        document.getElementById("question-container").style.display = 'none';
        document.getElementById("result").style.display = 'none';
        document.getElementById("mistakes-title").style.display = 'none';
        document.getElementById("resultTable").querySelector('thead').style.display = 'none';
        document.getElementById("resultTable").querySelector('tbody').innerHTML = '';
        document.getElementById("result-buttons").style.display = 'none';
    }

    // リトライ
    function retryMistakes() {
        currentProblems = results.filter(result => !result.isCorrect);
        results = [];
        
        if (currentProblems.length > 0) {
            resetUI();
            
            document.getElementById("question-container").style.display = 'block';
            document.getElementById("answer").disabled = false;
            document.getElementById('answer').focus();
            
            showNextProblem();
        } else {
            const resultContainer = document.getElementById("result");
            resultContainer.textContent = "間違えた問題がありません。";
            resultContainer.style.display = 'block';
        }
    }

</script>
</body>
</html>
